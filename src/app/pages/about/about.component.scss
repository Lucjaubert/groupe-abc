@use "sass:map";
@use "../../../styles/_variables.scss" as vars;

/* ===== Aliases ===== */
$blue:       map.get(vars.$theme-colors, "light-blue");
$blue-hero:  #444798;
$red:        map.get(vars.$theme-colors, "light-red");
$grey-100:   map.get(vars.$theme-colors, "light-grey");
$white:      map.get(vars.$theme-colors, "white");

/* ========================= */
/* Pré-cachage local (NEWS)  */
/* ========================= */
.about-wrapper {
  .prehide {
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    will-change: transform, opacity;
  }
  .prehide-row {
    opacity: 0;
    visibility: hidden;
  }
}

/* ===== Wrapper/Section ===== */
.about-wrapper { width: 100%; }

.section {
  position: relative;
  isolation: isolate;
  --pad-y: clamp(48px, 7vw, 96px);

  .section-inner {
    position: relative;
    z-index: 1;
    width: 100%;
    margin-inline: auto;
    padding-inline: clamp(16px, 3vw, 40px);
    padding-block: var(--pad-y);
  }
}

/* ========================= */
/* CORE (titre + 2 colonnes) */
/* ========================= */
.block-title {
  color: $blue-hero;
  font-size: clamp(32px, 3.2vw, 60px);
  font-weight: map.get(vars.$font-weight, "regular");
  line-height: 1.1;
  margin: 0 0 38px;
}

.core-grid {
  --core-gap: clamp(48px, 8vw, 148px);
  --core-left-col: 55%;
  display: grid;
  grid-template-columns: 1fr;
  grid-template-areas:
    "left"
    "right";
  row-gap: clamp(24px, 4vw, 40px);

  @media (min-width: 992px) {
    grid-template-columns:
      minmax(0, var(--core-left-col))
      minmax(0, calc(100% - var(--core-left-col)));
    grid-template-areas: "left right";
    column-gap: var(--core-gap);
  }
}

.core-left  { grid-area: left;  display: flex; flex-direction: column; }
.core-right { grid-area: right; display: flex; flex-direction: column; gap: clamp(10px, 2vw, 14px); align-items: flex-start; }

.block-html {
  color: $blue;
  font-size: map.get(vars.$font-size, "30"); /* 16px */
  line-height: 1.6;
  p { margin: 0 0 12px; }
  p:last-child { margin-bottom: 0; }
}

.panel-list.about-where-list {
  list-style: none; margin: 0; padding: 0;
  display: flex; flex-direction: column; gap: clamp(8px, 1.8vw, 12px);
}
.panel-list.about-where-list li {
  display: flex; align-items: center; gap: 10px;
  color: $blue-hero; font-size: 20px;

  /* 🔎 Hover doux UNIQUEMENT sur les items de lieux */
  transform-origin: left center;
  transition: transform .28s cubic-bezier(.22,.61,.36,1);
  will-change: transform;
}
.panel-list.about-where-list li::before {
  content: "—"; color: $red; font-size: 18px; margin-right: 6px;
}
.panel-list.about-where-list li:hover,
.panel-list.about-where-list li:focus-visible {
  transform: scale(1.04);
}

/* ========================= */
/* MESH (maillage)          */
/* ========================= */
.mesh {
  .mesh-title {
    color: $blue;
    font-size: map.get(vars.$font-size, "80"); /* 36 */
    font-weight: map.get(vars.$font-weight, "regular");
    line-height: normal;
    text-align: center;
    margin: 0;
  }

  .mesh-skyline {
    width: 100%;
    img { display: block; width: 100%; height: auto; margin-top: clamp(24px, 4vw, 40px); }
  }

  /* Trait animé + labels */
  .mesh-levels {
    --lineW: 0%; /* animé par GSAP -> 100% */
    position: relative;
    list-style: none;
    margin: clamp(18px, 3vw, 28px) 0 0;
    padding: 18px 0 0;
  }
  .mesh-levels::before {
    content: "";
    position: absolute;
    left: 0; top: 0;
    height: 2px;
    width: var(--lineW);
    background: $blue-hero;
  }
  .mesh-levels li {
    position: absolute;
    top: 18px;
    color: $blue-hero;
    font-size: 22px;
    text-transform: uppercase;
    white-space: nowrap;
  }
  .mesh-levels li:first-child { left: 0; }
  .mesh-levels li:nth-child(2) { left: 50%; transform: translateX(-50%); }
  .mesh-levels li:last-child { right: 0; }
}

/* ========================= */
/* MAP (Où ?)               */
/* ========================= */
.map-section {
  .map-grid {
    display: grid;
    gap: clamp(24px, 4vw, 48px);
    grid-template-columns: 1fr;

    @media (min-width: 992px) {
      grid-template-columns: 2fr 400px;
      column-gap: clamp(80px, 10vw, 140px);
      align-items: center; /* centre verticalement la colonne "Où ?" par rapport à la carte */
    }
  }

  /* Sécurité : si le parent change, on garde chaque colonne centrée */
  .map-image,
  .map-list {
    align-self: center;
  }

  .map-image img { display:block; width:100%; height:auto; }

  .map-title {
    color: $blue-hero;
    font-size: map.get(vars.$font-size, "100"); /* 48 */
    font-weight: map.get(vars.$font-weight, "regular");
    margin: 0 0 8px;
  }

  .map-list ul {
    list-style: none; margin: 0; padding: 0;
    display: flex; flex-direction: column; gap: clamp(8px, 1.6vw, 12px);
  }
  .map-list li {
    display: flex; align-items: center; gap: 10px;
    color: $blue-hero; font-size: 20px;

    /* 🔎 Hover doux UNIQUEMENT sur les items de lieux */
    transform-origin: left center;
    transition: transform .28s cubic-bezier(.22,.61,.36,1);
    will-change: transform;
  }
  .map-list li::before { content: "—"; color: $red; }
  .map-list li:hover,
  .map-list li:focus-visible {
    transform: scale(1.04);
  }

  @media (prefers-reduced-motion: reduce) {
    .map-list li {
      transition: none !important;
      transform: none !important;
    }
  }
}

/* ====== NOS VALEURS ====== */
.values {
  min-block-size: 506px;
  --pad-y: clamp(56px, 6vw, 80px);

  .section-inner {
    padding-block: var(--pad-y);
  }

  .values-bg {
    position: absolute;
    top: 0;
    bottom: 0;
    left: calc(-1 * var(--content-gutter));
    right: calc(-1 * var(--content-gutter));
    pointer-events: none;
    z-index: 0;
  }

  .values-bg .values-layer {
    position: absolute;
    inset: 0;
    background: $grey-100;
    opacity: 1;
  }

  .values-title {
    color: $blue-hero;
    font-weight: map.get(vars.$font-weight, "regular");
    text-align: center;
    font-size: clamp(28px, 3.2vw, 40px);
    line-height: 1.1;
    margin: 0 0 80px;
  }

  .values-grid {
    /* grille par défaut */
    display: grid;
    grid-template-columns: repeat(1, minmax(240px, 1fr));
    gap: clamp(28px, 4vw, 48px);
    justify-items: center;
    align-items: start;

    @media (min-width: 992px) {
      /* on expose le column-gap comme variable pour centrer le trait */
      --gap-x: clamp(80px, 10vw, 140px);
      grid-template-columns: repeat(3, 1fr);
      column-gap: var(--gap-x);
    }
  }

  .value-item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    max-width: 360px;
  }

  .value-item .icon-wrap {
    display: grid;
    place-items: center;
    margin-bottom: clamp(16px, 2vw, 20px);
  }

  .value-item .icon-wrap img {
    display: block;
    max-width: clamp(84px, 7vw, 96px);
    max-height: clamp(84px, 7vw, 96px);
    height: auto;
    width: auto;
  }

  .value-item .value-name {
    color: $blue-hero;
    font-weight: map.get(vars.$font-weight, "regular");
    font-size: clamp(18px, 2.1vw, 22px);
    line-height: 1.25;
    margin: 0 0 clamp(10px, 1.6vw, 12px);
  }

  .value-item .value-desc {
    color: $blue;
    font-weight: map.get(vars.$font-weight, "regular");
    font-size: clamp(13px, 1.6vw, 14px);
    line-height: 1.55;
    max-width: 320px;
  }

  .value-item .value-desc p { margin: 0; }
  .value-item .value-desc p + p { margin-top: 6px; }

  /* Traits entre les cartes — conservés, mais désormais centrés dans le gap */
  .value-item .divider { display: none; }

  @media (min-width: 992px) {
    .value-item .divider {
      /* base identique */
      display: block;
      position: absolute;
      top: calc(clamp(84px, 7vw, 96px) / 2 + 10px);
      height: 2px;
      background: $blue-hero;
      opacity: .45;
      transform: translate(-50%, -50%); /* centré verticalement + on recentre l’élément */

      /* centrage HORIZONTAL dans la “zone violette” (le column-gap) :
         on place l’origine juste au milieu du gap, à mi-distance de l’item courant */
      left: calc(100% + (var(--gap-x, 0px) / 2));

      /* largeur du trait : ta largeur d’origine,
         mais tu peux la “clamp” pour ne pas dépasser le gap */
      --divider-w: clamp(64px, 7vw, 96px);
      width: min(var(--divider-w), max(48px, calc(var(--gap-x, 9999px) - 24px)));

      /* Accessoire */
      pointer-events: none;
    }
  }

  /* ===== Hooks d’animation (même logique que News) ===== */
  .values-title.prehide {
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    will-change: transform, opacity;
  }
  .value-item.prehide {
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    will-change: transform, opacity;
  }
  .value-item.is-animating .icon-wrap img { transform-origin: center; }

  @media (prefers-reduced-motion: reduce) {
    .values-title.prehide,
    .value-item.prehide {
      opacity: 1 !important;
      visibility: visible !important;
      transform: none !important;
      will-change: auto !important;
    }
  }
}


/* ========================= */
/* Affiliations / Déontologie*/
/* ========================= */
.affiliations, .deon {
  .aff-title, .deon-title {
    color: $blue;
    font-size: map.get(vars.$font-size, "80"); /* 36 */
    line-height: normal;
    margin-bottom: 58.5px;
  }

  .aff-list, .deon-list {
    list-style: none; margin: 0; padding: 0;
    border-top: map.get(vars.$border-size, "2") solid $blue-hero;
  }

  /* — Appartenance : 3 colonnes (nom, logo, chevron) — */
  .aff-row {
    --row-h: 98px; /* hauteur minimale de l’entête */
    display: grid;
    grid-template-columns: 1fr auto auto; /* texte | logo | chevron */
    align-items: center;
    column-gap: clamp(24px, 4vw, 48px);
    /* >>> on laisse la ligne grandir quand la description est ouverte */
    min-block-size: var(--row-h);  /* au lieu de block-size */
    padding-block: 0;
    border-bottom: map.get(vars.$border-size, "2") solid $blue-hero;
  }
  .aff-line { display: contents; }

  /* Typo à 18px comme demandé */
  .aff-name { color: $blue-hero; font-size: 18px; line-height: 1.3; font-weight: 600; }
  .aff-name .aff-abbr { font-weight: map.get(vars.$font-weight, "600"); }
  .aff-name .aff-label { font-weight: map.get(vars.$font-weight, "600"); }

  .aff-logo { width: 75px; height: 75px; object-fit: contain; justify-self: end; }

  .aff-toggle { background: none; border: 0; color: $blue-hero; justify-self: end; cursor: pointer; }
  .chevron { width: 24px; height: 34px; transform: rotate(90deg); transition: transform .25s ease; }
  .aff-row.open .chevron { transform: rotate(0deg); }

  /* La description n’occupe QUE la 1ère colonne (texte).
     Du coup elle ne passe plus derrière le logo/chevron. */
  .aff-desc { grid-column: 1 / 2; padding: 8px 0 16px; }
  .aff-desc-inner {
    color: $blue;
    font-size: 16px !important;      /* taille demandée */
    line-height: 1.55;
  }
  .aff-desc-inner p { margin: 0 0 8px; }
  .aff-desc-inner p:last-child { margin-bottom: 0; }

  /* — Déontologie : 2 colonnes (nom, chevron) — */
  .deon-row {
    --row-h: 98px;
    display: grid;
    grid-template-columns: 1fr auto; /* texte | chevron */
    align-items: center;
    column-gap: clamp(24px, 4vw, 48px);
    /* même correction : hauteur minimale, pas fixe */
    min-block-size: var(--row-h);
    padding-block: 0;
    border-bottom: map.get(vars.$border-size, "2") solid $blue-hero;
  }
  .deon-line { display: contents; }

  /* Harmonisation à 18px ici aussi */
  .deon-name {
    color: $blue-hero;
    font-size: 18px;
    line-height: 1.3;
    font-weight: 600;
  }
  .deon-toggle { background: none; border: 0; color: $blue-hero; justify-self: end; cursor: pointer; }
  .deon-row .chevron { width: 24px; height: 34px; transform: rotate(90deg); transition: transform .25s ease; }
  .deon-row.open .chevron { transform: rotate(0deg); }

  .deon-desc { grid-column: 1 / -1; padding: 8px 0 18px; }
  .deon-desc-inner {
    color: $blue;
    font-size: 16px !important;         /* taille unifiée */
    line-height: 1.55;
  }
  .deon-desc-inner p { margin: 0 0 8px; }
  .deon-desc-inner p:last-child { margin-bottom: 0; }
}


/* ============================  TIMELINE ============================ */
.timeline {
  --years-col: 152px;
  --rail-w: 2px;
  --row-gap: 96px;
  --dash-w: 24px;
  --rail-gap: clamp(48px, 6vw, 110px);
  --content-max: 940px;
  position: relative;
  isolation: isolate;

  .timeline-bg {
    position: absolute;
    inset: 0;
    left: calc(-1 * var(--content-gutter));
    right: calc(-1 * var(--content-gutter));
    pointer-events: none;
    z-index: 0;
  }

  .timeline-bg .timeline-layer {
    position: absolute;
    inset: 0;
    background: $grey-100;
  }

  .section-inner {
    position: relative;
    z-index: 1;
  }

  .tl-grid {
    position: relative;
    display: grid;
    grid-template-columns: var(--years-col) 1fr;
    column-gap: var(--rail-gap);
    row-gap: var(--row-gap);
  }

  .tl-rail {
    position: absolute;
    top: 0;
    bottom: -20px; /* un peu de rab */
    left: calc(var(--years-col) + var(--rail-gap));
    width: var(--rail-w);
    background: $blue-hero;
    transform: scaleY(0);
    transform-origin: top;
  }

  .timeline-title {
    grid-column: 1 / -1;
    margin: 0 0 clamp(28px, 4vw, 40px);
    max-width: var(--content-max);
    margin-inline: auto;
    text-align: center;
    color: $blue-hero;
    font-weight: map.get(vars.$font-weight, "regular");
    font-size: clamp(28px, 3.2vw, 40px);
    line-height: 1.1;
  }

  .tl-year {
    justify-self: end;
    align-self: start;
    color: $blue-hero;
    font-size: 24px;
    font-weight: map.get(vars.$font-weight, "regular");
    line-height: 1;
    position: relative;
    text-align: right;
    white-space: nowrap;
    padding-right: calc(var(--rail-gap) + var(--rail-w));
    --dashNow: 0px; /* animé par GSAP 0 → var(--dash-w) */
  }

  .tl-year::after {
    content: "";
    position: absolute;
    top: .6em; /* Référence géométrique qu’on va reproduire en JS */
    right: calc(var(--rail-gap) - var(--dash-w) - 6px);
    width: var(--dashNow);
    height: 2px;
    background: $red;
  }

  .tl-body {
    grid-column: 2;
    max-width: var(--content-max);
    width: 100%;
    justify-self: center;
    margin-inline: auto;
    padding-left: var(--rail-gap);
  }

  .tl-item-title {
    color: $blue-hero;
    font-weight: map.get(vars.$font-weight, "regular");
    font-size: clamp(18px, 2vw, 22px);
    line-height: 1.25;
    margin: 0 0 10px;
  }

  .tl-desc {
    color: $blue;
    font-weight: map.get(vars.$font-weight, "regular");
    font-size: map.get(vars.$font-size, "20");
    line-height: 1.55;
  }

  .tl-desc p { margin: 0; }
  .tl-desc p + p { margin-top: 6px; }

  @media (max-width: 720px) {
    --years-col: 110px;
    --row-gap: 64px;
    --rail-gap: clamp(28px, 8vw, 64px);
    --content-max: 92vw;
  }
}



/* A11y helper */
.sr-only, .visually-hidden {
  position: absolute !important;
  width: 1px !important; height: 1px !important;
  padding: 0 !important; margin: -1px !important;
  overflow: hidden !important; clip: rect(0,0,0,0) !important;
  white-space: nowrap !important; border: 0 !important;
}

@media (prefers-reduced-motion: reduce) {
  .about-wrapper * {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
}
