<div class="about-wrapper">

  <!-- ===== Core (3 blocs) ===== -->
  <section class="section core" *ngIf="core.length && mapSection as ms">
    <div class="section-inner px-0">
      <!-- Titre : on garde celui du bloc gauche -->
      <h2 class="block-title" *ngIf="core[0]?.title">{{ core[0].title }}</h2>

      <div class="core-grid px-0">
        <!-- Colonne gauche : intro -->
        <article class="core-block core-left" *ngIf="core[0] as left">
          <div class="block-html" [innerHTML]="left.html"></div>
        </article>

        <!-- Colonne droite : liste “Où ?” provenant de mapSection -->
        <aside class="core-block core-right">
          <ul class="panel-list about-where-list" *ngIf="ms.items?.length">
            <li *ngFor="let item of ms.items; trackBy: trackByIndex">{{ item }}</li>
          </ul>
        </aside>
      </div>
    </div>
  </section>


  <!-- ===== Mesh / Maillage ===== -->
  <section class="section mesh" *ngIf="mesh?.title || mesh?.image || mesh?.levels?.length">
    <div class="section-inner px-0">

      <h2 class="mesh-title mb-5" *ngIf="mesh?.title">{{ mesh?.title }}</h2>

      <div class="mesh-skyline mt-5" *ngIf="mesh?.image">
        <img [src]="mesh?.image" alt="" aria-hidden="true" />
      </div>

      <ul class="mesh-levels" *ngIf="mesh?.levels?.length">
        <li *ngFor="let l of mesh?.levels; trackBy: trackByIndex">{{ l }}</li>
      </ul>
    </div>
  </section>

  <!-- ===== Carte / Où ? ===== -->
  <section class="section map-section" *ngIf="mapSection as ms">
    <div class="section-inner px-0">
      <div class="map-grid">

        <!-- Colonne gauche : image carte -->
        <div class="map-image" *ngIf="ms.image">
          <img [src]="ms.image" alt="Carte du Groupe ABC" />
        </div>

        <!-- Colonne droite : titre + liste, centrés verticalement -->
        <div class="map-list">
          <h2 class="map-title" *ngIf="ms.title">{{ ms.title }}</h2>

          <ul *ngIf="ms.items?.length">
            <li *ngFor="let item of ms.items; trackBy: trackByIndex">{{ item }}</li>
          </ul>
        </div>

      </div>
    </div>
  </section>


  <!-- ===== Nos valeurs  ===== -->
  <section class="section values" *ngIf="coreValues?.length">
    <div class="values-bg">
      <div class="values-layer active"></div>
    </div>

    <div class="section-inner">
      <h2 class="values-title" *ngIf="coreValuesTitle">{{ coreValuesTitle }}</h2>

      <ul class="values-grid" role="list">
        <li class="value-item" *ngFor="let v of coreValues; index as i; trackBy: trackByIndex">
          <div class="icon-wrap" *ngIf="v.iconUrl">
            <img [src]="v.iconUrl" alt="" aria-hidden="true" />
          </div>

          <h3 class="value-name" *ngIf="v.title">{{ v.title }}</h3>
          <div class="value-desc" *ngIf="v.html" [innerHTML]="v.html"></div>

          <!-- Traits séparateurs (desktop), masqués sur le dernier -->
          <span class="divider" *ngIf="i < coreValues.length - 1"></span>
        </li>
      </ul>
    </div>
  </section>


  <!-- ===== Appartenance ===== -->
  <section class="section affiliations" *ngIf="affiliations?.length">
    <div class="section-inner px-0">

      <h2 class="aff-title" *ngIf="affTitle">{{ affTitle }}</h2>

      <ul class="aff-list" role="list">
        <li class="aff-row"
            *ngFor="let a of affiliations; let i = index; trackBy: trackByIndex"
            [class.open]="affOpen[i]">

          <!-- Ligne cliquable -->
          <div class="aff-line">
            <!-- Nom : "RICS : Royal Institution of Chartered Surveyors" découpé -->
            <div class="aff-name" *ngIf="a.excerpt as n">
              <span class="aff-abbr">{{ splitAffName(n).abbr }} :</span>
              <span class="aff-label">{{ splitAffName(n).label }}</span>
            </div>

            <img class="aff-logo" *ngIf="a.logo" [src]="a.logo" alt="" aria-hidden="true" />

            <button class="aff-toggle"
                    type="button"
                    [attr.aria-expanded]="affOpen[i] ? 'true':'false'"
                    (click)="toggleAff(i)">
              <svg class="chevron" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

          <!-- Description (affichée au clic) -->
          <div class="aff-desc" *ngIf="a.content && affOpen[i]">
            <div class="aff-desc-inner" [innerHTML]="a.content"></div>
          </div>
        </li>
      </ul>

    </div>
  </section>


  <!-- ===== Déontologie ===== -->
  <section class="section deon" *ngIf="deontology?.length">
    <div class="section-inner px-0">

      <h2 class="deon-title" *ngIf="deonTitle">{{ deonTitle }}</h2>

      <ul class="deon-list" role="list">
        <li class="deon-row"
            *ngFor="let d of deontology; let i = index; trackBy: trackByIndex"
            [class.open]="deonOpen[i]">

          <div class="deon-line">
            <div class="deon-name">{{ d.title }}</div>

            <button class="deon-toggle"
                    type="button"
                    [attr.aria-expanded]="deonOpen[i] ? 'true':'false'"
                    (click)="toggleDeon(i)">
              <svg class="chevron" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

          <div class="deon-desc" *ngIf="d.html && deonOpen[i]">
            <div class="deon-desc-inner" [innerHTML]="d.html"></div>
          </div>
        </li>
      </ul>

    </div>
  </section>



<!-- ===== Timeline ===== -->
<section class="section timeline" *ngIf="timeline.length">
  <!-- Fond plein écran -->
  <div class="timeline-bg"><div class="timeline-layer"></div></div>

  <div class="section-inner px-0">
    <div class="tl-grid">
      <!-- Rail bleu entre colonnes -->
      <span class="tl-rail" aria-hidden="true"></span>

      <!-- Titre, aligné sur la colonne de droite -->
      <h2 class="timeline-title"> {{ timelineTitle }} </h2>

      <!-- Chaque événement rend 2 frères : année (col 1) + contenu (col 2) -->
      <ng-container *ngFor="let s of timeline; trackBy: trackByIndex">
        <div class="tl-year">{{ s.year }}</div>

        <div class="tl-body">
          <h3 class="tl-item-title" *ngIf="s.title">{{ s.title }}</h3>
          <div class="tl-desc" *ngIf="s.html" [innerHTML]="s.html"></div>
        </div>
      </ng-container>
    </div>
  </div>
</section>



</div>
