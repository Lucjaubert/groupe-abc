@use "sass:map";
@use "../../../styles/_variables.scss" as vars;

$blue:       map.get(vars.$theme-colors, "light-blue");
$red:        map.get(vars.$theme-colors, "light-red");
$grey-100:   map.get(vars.$theme-colors, "light-grey");
$white:      map.get(vars.$theme-colors, "white");
$bd-2:       map.get(vars.$border-size, "2");

$fs12: map.get(vars.$font-size, "10");  // 12
$fs16: map.get(vars.$font-size, "30");  // 16
$fs20: map.get(vars.$font-size, "40");  // ~20
$fs24: map.get(vars.$font-size, "50");  // 24
$fs36: map.get(vars.$font-size, "80");  // 36
$fs60: map.get(vars.$font-size, "110"); // ~60

.methods-wrapper { width: 100%; }

/* ==== prehide helpers — SCOPÉS AU COMPOSANT ==== */
.hero .prehide,
.assets .prehide,
.values .prehide,
.evals .prehide,
.piloting .prehide,
.faq .prehide {
  opacity: 0;
  visibility: hidden;
  transform: translateY(20px);
  will-change: transform, opacity;
}

.assets .prehide-row,
.values .prehide-row,
.evals  .prehide-row,
.piloting .prehide-row,
.faq .prehide-row {
  opacity: 0;
  visibility: hidden;
  will-change: transform, opacity;
}

/* ===== HERO ===== */
.page-title{
  color: $blue;
  font-size: clamp(32px, 3.2vw, 60px);
  font-weight: 400;
  line-height: normal;
  margin-bottom: 8px;
}
.page-sub{
  color: $blue;
  font-size: clamp(24px, 3.2vw, 36px);
  margin: 0 0 18px 0;
}
.page-intro{
  color: $blue;
  font-size: $fs16;
  line-height: 1.6;
}

/* ===================== */
/* DOMAINES D’ACTIFS     */
/* ===================== */
.assets{
  --band-h: 488.057px;

  position: relative;
  isolation: isolate;
  margin-top: clamp(36px, 5vw, 74px);

  .assets-bg{
    position: absolute;
    top: 0;
    left: calc(-1 * var(--content-gutter));
    right: calc(-1 * var(--content-gutter));
    height: var(--band-h);
    pointer-events: none;
    z-index: 0;

    &:not(.is-ready) .assets-layer { transition: none !important; }

    .assets-layer{
      position: absolute;
      inset: 0;
      background: #F5F4F8;
    }
  }

  .section-inner{
    position: relative;
    z-index: 1;
    padding-block: 0;

    min-height: var(--band-h);
    display: flex;
    align-items: center;
  }

  .assets-grid{
    list-style: none;
    margin: 0;
    padding: 0;

    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: clamp(20px, 3.5vw, 40px);
    width: 100%;
  }

  .asset-head{
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }
  .asset-icon{ width: 32px; height: 32px; object-fit: contain; }
  .asset-title{
    color: $blue;
    font-size: clamp(18px, 2.5vw, 24px);
    font-weight: 600;
    margin: 0;
    line-height: 1.1;
  }

  .panel-list{
    margin: 0;
    padding: 0;
    list-style: none;

    li{
      display: flex;
      align-items: baseline;
      margin: 8px 0;

      color: $blue;
      font-family: "Plus Jakarta Sans", sans-serif;
      font-size: clamp(14px, 2.2vw, 16px);
      font-weight: map.get(vars.$font-weight, "regular");
      line-height: 25px;
      will-change: transform, opacity;
    }

    li::before{
      content: "—";
      color: $red;
      font-family: "Plus Jakarta Sans", sans-serif;
      font-size: clamp(14px, 2.2vw, 16px);
      font-weight: map.get(vars.$font-weight, "regular");
      line-height: normal;
      margin-right: 6px;
      flex: 0 0 auto;
    }

    .li-text, .li-group{ flex: 1 1 auto; }
  }

  /* ===================== */
  /* LIENS items cliquables */
  /* ===================== */
  .panel-list a,
  .panel-list a:visited,
  .panel-list a:hover,
  .panel-list a:focus,
  .panel-list a:active{
    color: inherit;
    text-decoration: none;
  }

  .panel-list a:focus-visible{
    outline: 2px solid rgba(68, 70, 151, 0.35);
    outline-offset: 2px;
    border-radius: 6px;
    text-decoration: none;
  }

  .li-link{
    display: inline;
    color: inherit;
    text-decoration: none;
  }
  .li-link:hover,
  .li-link:focus,
  .li-link:active,
  .li-link:visited{
    color: inherit;
    text-decoration: none;
  }

  /* ===================== */
  /* ✅ Ajout : ligne + icône ouvrir */
  /* ===================== */
  .li-row{
    display: inline-flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 10px;
    min-width: 0;
  }

  .li-open{
    width: 28px;
    height: 28px;
    border: 0;
    background: transparent;
    padding: 0;
    margin-left: 6px;
    color: $blue;
    cursor: pointer;
    align-items: center;
    justify-content: center;

    opacity: 0.75;
    transition: opacity .15s ease, transform .15s ease;
    border-radius: 8px;

    &:hover{
      opacity: 1;
      transform: translateY(-1px);
    }

    &:focus-visible{
      outline: 2px solid rgba(68, 70, 151, 0.35);
      outline-offset: 2px;
    }
  }

  .ts-link-icon{
    width: 14px;
    height: 14px;
    display: inline-block;
    flex: 0 0 auto;
  }

  .sub-list{
    list-style: none;
    margin: 6px 0 0;
    padding: 0;

    li{
      display: flex;
      align-items: baseline;
      gap: 10px;
      margin: 6px 0 0;
      color: $blue;
      line-height: 1.35;
      font-size: clamp(14px, 2.2vw, 16px);

      &::before{
        content: "•";
        flex: 0 0 auto;
        color: $blue;
        font-size: 0.9em;
        line-height: 1;
        transform: translateY(-.05em);
      }
    }
  }

  @media (max-width: 768px){
    .assets-grid{ grid-template-columns: 1fr; }

    .section-inner{
      min-height: auto;
      padding-block: 24px;
    }

    .assets-bg{
      top: 0;
      bottom: 0;
      height: auto;
      min-height: 0;
    }
  }
}

/* ===================== */
/* WHEEL / VALUES        */
/* ===================== */
.values{
  --values-top-gap: 74px;
  --gap-title-wheel: 4px;
  --tighten: 28px;

  display: grid;
  grid-template-rows: auto 1fr;

  .section-inner{
    padding-top: var(--values-top-gap);
  }

  .values-title{
    color: $blue;
    font-size: clamp(24px, 3.2vw, 36px);
    font-weight: 400;
    line-height: 1.2;
    margin: 0 0 var(--gap-title-wheel);
    align-self: start;
  }

  .values-intro {
    color: $blue;
    font-size: 16px;
    line-height: 1.6;
    margin-top: 12px;
    margin-bottom: 24px;

    p { margin: 0; }
  }

  .wheel{
    --size: clamp(560px, 66vw, 960px);
    position: relative;
    width: var(--size);
    height: var(--size);
    align-self: start;
    margin-top: calc(-1 * var(--tighten));
    margin-left: auto;
    margin-right: auto;
    overflow: visible;
  }

  .wheel-img{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: min(100%, calc(var(--size) * 0.96));
    height: auto;
    display: block;
    background: transparent;
  }

  @media (max-width: 900px){
    --values-top-gap: 40px;
    --gap-title-wheel: 2px;

    .wheel{ --size: clamp(100px, 92vw, 760px); }
    .wheel-img{ width: min(100%, calc(var(--size) * 0.98)); }
  }
}

@media (min-width: 1024px){
  .values{
    --title-image-gap: 24px;

    display: block;

    .values-title{
      margin-bottom: var(--title-image-gap);
    }

    .wheel{
      --size: clamp(560px, 66vw, 960px);
      width: var(--size);
      height: auto;
      margin: 0 auto;
      align-self: auto;
      overflow: visible;
      margin-top: 0 !important;
    }

    .wheel-img{
      position: static;
      transform: none;
      width: 100%;
      height: auto;
      margin: 0 auto;
      background: transparent;
    }
  }
}

/* ===================== */
/* MÉTHODES = Accordéon  */
/* ===================== */

/* ✅ on neutralise les anciennes règles liées à row-line (puisqu’on passe sur row-head) */
.eval-row .row-line > .row-name{
  white-space: normal;
}
.eval-row .row-line > .row-name br{
  display: none;
}

.evals {
  --evals-top-gap: 105px;
  --evals-title-bottom-gap: 25px;

  .section-inner { padding-top: var(--evals-top-gap); }

  .eval-title{
    color: $blue;
    font-size: clamp(24px, 3.2vw, 36px);
    font-weight: 400;
    line-height: normal;
    margin: 0 0 var(--evals-title-bottom-gap);
  }

  .eval-intro {
    margin: 12px 0 30px;
    line-height: 1.6;
    color: $blue;

    p { margin: 0; }
    p + p { margin-top: 10px; }
  }

  .eval-list{
    list-style: none;
    margin: 0;
    padding: 0;
    border-top: $bd-2 solid $blue;
  }

  .eval-row{
    border-bottom: $bd-2 solid $blue;
    padding: 0;
  }

  /* ✅ header cliquable pleine largeur */
  .row-head{
    width: 100%;
    border: 0;
    background: none;
    padding: 0;
    cursor: pointer;
    text-align: left;
    color: $blue;

    display: grid;
    /* ✅ minmax(0, 1fr) = clé pour permettre l'ellipsis en grid */
    grid-template-columns: auto minmax(0, 1fr) auto;
    align-items: center;
    column-gap: clamp(16px, 3vw, 24px);

    min-height: clamp(78px, 10vw, 98px);
  }

  .row-head:focus-visible{
    outline: 2px solid rgba(68, 70, 151, 0.35);
    outline-offset: 3px;
    border-radius: 10px;
  }

  .row-head:hover .chevron{
    opacity: 1;
  }

  .eval-icon{
    width: 56px;
    height: 56px;
    object-fit: contain;
    justify-self: start;
  }

  /* ✅ 1 LIGNE SUR DESKTOP */
  .row-name{
    /* important en grid pour permettre overflow/ellipsis */
    min-width: 0;

    /* écrase tes styles hérités vus dans DevTools (pre-line, width: 400vw, etc.) */
    width: auto !important;
    max-width: 100%;
    white-space: nowrap !important;

    overflow: hidden;
    text-overflow: ellipsis;

    text-align: left;
    align-self: center;

    color: $blue;
    font-size: clamp(14px, 3vw, 24px);
    font-weight: 400;
    line-height: 1.25;

    /* pas de wrap en desktop */
    overflow-wrap: normal;
    word-break: normal;
  }

  /* on neutralise les <br> injectés par WP */
  .row-name br{
    display: none !important;
  }

  /* si WP injecte des <p> / <div>, on les met inline (sinon ça casse la ligne) */
  .row-name > p,
  .row-name > div,
  .row-name > span{
    display: inline;
    margin: 0;
    padding: 0;
  }

  .chevron{
    width: 20px;
    height: 30px;
    transform: rotate(90deg);
    transition: transform .25s ease;
    justify-self: end;
    opacity: 0.9;
  }
  .eval-row.open .chevron{ transform: rotate(0deg); }

  .row-desc{
    padding: 8px 0 18px;
    padding-left: calc(56px + clamp(16px, 3vw, 24px));
  }

  .row-desc-inner{
    color: $blue;
    font-size: $fs12;
    line-height: 1.55;
    p{ margin: 0 0 10px; }
    p:last-child{ margin-bottom: 0; }
  }

  .eval-row.open .row-head{
    padding-top: 16px;
  }

  /* ✅ SUR PETIT ÉCRAN : ON AUTORISE LE RETOUR À LA LIGNE */
  @media (max-width: 768px){
    .chevron { width: 18px; height: 18px; }

    .row-name{
      white-space: normal !important;
      overflow: visible;
      text-overflow: clip;
      overflow-wrap: anywhere;
    }
  }
}

/* ===================== */
/* PILOTAGE DES MISSIONS */
/* ===================== */
.piloting {
  margin-bottom: 105px;

  .pilot-title {
    color: $blue;
    font-size: clamp(24px, 3.2vw, 36px);
    font-weight: 400;
    line-height: 1.2;
    margin: clamp(80px, 10vw, 120px) 0 16px;
  }

  .pilot-intro {
    color: $blue;
    font-size: $fs16;
    line-height: 1.55;
    margin-bottom: clamp(40px, 5vw, 75px);
  }

  .pilot-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: clamp(24px, 4vw, 48px);
  }

  .pilot-figure {
    margin: 0;
    text-align: center;

    img {
      display: block;
      max-width: 60%;
      height: auto;
      margin-inline: auto;
    }

    figcaption {
      color: $blue;
      font-size: $fs12;
      margin-top: 8px;
    }
  }

  @media (max-width: 900px) {
    .pilot-grid {
      grid-template-columns: 1fr;
      row-gap: clamp(80px, 7vw, 80px);
      column-gap: 0;
    }
  }
}


/* ===================================================================== */
/* ================================= FAQ =============================== */
/* ===================================================================== */
.faq {

  .faq-inner {
    width: 100%;
    margin-inline: auto;
  }

  .faq-title {
    margin: 0 0 clamp(18px, 3vw, 28px);
    color: $blue;
    font-family: "Plus Jakarta Sans", sans-serif;
    font-size: map.get(vars.$font-size, "80"); /* 36px */
    font-weight: map.get(vars.$font-weight, "regular");
    line-height: 1.1;
  }

  .faq-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: clamp(14px, 2.4vw, 18px);
  }

  .faq-item {
    border-radius: 12px;
    background: rgba(68, 70, 151, 0.06);
    overflow: hidden;
  }

  .faq-qrow {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 14px;

    padding: clamp(14px, 2.2vw, 18px);
    border: 0;
    background: transparent;
    cursor: pointer;
    text-align: left;

    color: $blue;
    font-family: "Plus Jakarta Sans", sans-serif;
  }

  .faq-q {
    margin: 0;
    font-size: map.get(vars.$font-size, "40"); /* ~20px */
    font-weight: 500;
    line-height: 1.3;
  }

  .faq-chevron {
    width: 22px;
    height: 22px;
    flex: 0 0 auto;
    opacity: 0.9;
    transition: transform 0.2s ease;
  }

  .faq-qrow[aria-expanded="true"] .faq-chevron {
    transform: rotate(180deg);
  }

  .faq-a {
    padding: 0 clamp(14px, 2.2vw, 18px) clamp(14px, 2.2vw, 18px);

    color: $blue;
    font-family: "Plus Jakarta Sans", sans-serif;
    font-size: map.get(vars.$font-size, "30"); /* 16px */
    font-weight: map.get(vars.$font-weight, "regular");
    line-height: 1.7;

    p { margin: 0 0 10px 0; }
    p:last-child { margin-bottom: 0; }
  }

  /* ✅ Etat fermé : DOM conservé mais masqué */
  .faq-a.is-collapsed {
    display: none;
  }
}

/* Fix listes dans innerHTML */
.faq .faq-a ul,
.faq .faq-a ol {
  margin: 10px 0 0 18px;
  padding: 0;

  font-family: inherit;
  font-size: 16px;
  line-height: inherit;
  font-weight: inherit;
}

.faq .faq-a li {
  margin: 0 0 6px 0;
  font-family: inherit;
  font-size: 16px;
  line-height: inherit;
  font-weight: inherit;
}

.faq .faq-a li::marker { font-size: 0.85em; }

/* Mobile */
@media (max-width: 768px) {
  .faq {
    padding-block: 40px;

    .faq-title {
      font-size: 24px;
      font-weight: 400;
      line-height: normal;
      margin-bottom: 16px;
    }

    .faq-item { border-radius: 0; }

    .faq-qrow { padding: 14px 12px; }

    .faq-q {
      font-size: 18px;
      line-height: 1.25;
    }

    .faq-chevron { width: 20px; height: 20px; }

    .faq-a {
      padding: 0 12px 14px;
      font-size: 14px;
      line-height: 1.6;
    }
  }

  .faq .faq-a ul,
  .faq .faq-a ol,
  .faq .faq-a li {
    font-size: 14px;
  }

  .faq .faq-a li::marker { font-size: 0.85em; }
}

@media (prefers-reduced-motion: reduce) {
  .methods-wrapper * {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
}

/* Debug fallback */
.methods-wrapper.no-anim {
  .prehide,
  .prehide-row {
    opacity: 1 !important;
    visibility: visible !important;
    transform: none !important;
  }
}
